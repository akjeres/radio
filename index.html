<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Radio Script</title>
    <style>
        audio {
            display: none !important;
        }
        .preloader {
            display: none;
        }
        .loading * {
            display: none;
        }
        .loading div.preloader {
            display: block;
        }
        .control {
            cursor: pointer;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script>
        var radio = null;
        var player = radio;
        var playButton = player;
        var volumeControl = playButton;
        var isPaused = true;
        var isMuted = false;
        var playTxt = '&#9658;';
        var pauseTxt = '&#9612;&#9612;';
        var eventEnabled = false;
        console.log('script. eventEnabled: ', eventEnabled);


        window.addEventListener('load', function(event) {
            console.log('window loaded');
            console.log('window loaded. eventEnabled: ', eventEnabled);
            // Player
            player = document.querySelector('.player');

                // Play/Pause button
            playButton = player.querySelector('.control');
            playButton.dataset['paused'] = Number(isPaused);
            playButton.innerHTML = isPaused ? playTxt : pauseTxt;
            playButton.addEventListener('click', function(e) {
                isPaused = playButtonHanler(this, playAudio, stopAudio);
            }, false);


            // Enable events
            eventEnabled = true;
            console.log('events enabled. eventEnabled: ', eventEnabled);
        });

        function playButtonHanler(button, playHandler, pauseHandler) {
            if (!eventEnabled) return;

            eventEnabled = false;
            button.dataset['paused'] = Number(!Number(button.dataset['paused']));
            var txt;
            var result = Number(button.dataset['paused']);
            if (result) {
                txt = playTxt;
                pauseHandler();
            } else {
                txt = pauseTxt;
                playHandler();
            }
            button.innerHTML = txt;

            return Number(button.dataset['paused']);
        };

        function playAudio() {
            radio = getAudio('audio');
            console.log('radio is loading');
            console.log(this);
            radio.addEventListener('loadeddata', function() {
                if(radio.readyState >= 2) {
                    radio.play();
                    console.log('audio is playing now');
                    console.log('duration: ', radio.duration);
                    eventEnabled = true;
                } else {
                    console.log('there was some error while loading audio');
                    stopAudio();
                }
            });
            function progressListener() {
                console.log('paused: ', this.paused);
            }
            radio.addEventListener('progress', progressListener);
            radio.addEventListener('progress', function() {
                if (this.paused) {
                    this.removeEventListener('progress', progressListener);
                }
            });
            radio.addEventListener('emptied', function(event) {
                stopAudio();
                console.log('empty');
            });
            radio.addEventListener('stalled', function(event) {
                this.pause();
                this.currentTime = 0;
                console.log('stalled');
            });
            radio.addEventListener('ended', function() {
                console.error(`ended loading: ${this.src}`);
                stopAudio();
            });
            radio.addEventListener('error', function() {
                console.error(`Error loading: ${this.src}`);
                stopAudio();
            });
            radio.addEventListener('abort', function() {
                console.error(`Aborting: ${this.src}`);
                stopAudio();
            });
        };
        function stopAudio() {
            console.log('audio is stopped now');

            if (radio) {
                radio.pause();
                radio.currentTime = 0;
                radio.src = null;
                radio.load();
            }
            radio = null;
            eventEnabled = true;

            console.log(this);
        };
        function getAudio(id) {
            var audioTag = document.getElementById(id);
            var audioSRC = audioTag.querySelector('source')['src'];

            return new Audio(audioSRC);
        }
        window.addEventListener('load', function() {
            var radioNode = document.getElementById('audio');
            var buttons = document.getElementById('buttons');
            buttons.addEventListener('click', function (e) {
                var target = e.target.closest('button');
                if (!target) return;

                radioNode[target.textContent.toLowerCase()]();
            });
        });
    </script>
</head>
<body>
    <div class="preloader">Loading</div>
    <div class="player"><button class="control"></button></div>
    <audio id="audio" controls="true" preload="none">
        <source src="http://online.hitfm.ua/HitFM_HD">
    </audio>
    <ul class="palylist"></ul>
    <div id="buttons">
        <button>play</button>
        <button>pause</button>
    </div>
</body>
</html>